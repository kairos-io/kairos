<!DOCTYPE html>
<html>
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.min.css" crossorigin="anonymous">
  
  <!-- Font awesome -->
  <link rel="stylesheet" href="/node_modules/@fortawesome/fontawesome-free/css/all.css" crossorigin="anonymous">

  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- CodeMirror -->
  <link rel="stylesheet" href="/node_modules/codemirror/lib/codemirror.css">
  <script src="/node_modules/codemirror/lib/codemirror.js"></script>
  <script src="/node_modules/codemirror/mode/yaml/yaml.js"></script>
  <link rel="stylesheet" href="/node_modules/codemirror/theme/material.css">

  <!-- Add the yaml-js library -->
  <script type="text/javascript" src="/node_modules/yamljs/dist/yaml.min.js"></script>

  <!-- Alpine.js -->
  <script defer src="/node_modules/alpinejs/dist/cdn.min.js"></script>
  <style>
    .navbar {
      background-color: #ee5007;
    }
    * {
      font-family: 'Open Sans', sans-serif;
    }
  </style>  
  <title>WebUI System Installer</title>
</head>
<body class="bg-gray-200 font-sans" x-data="{page: location.hash}">
    <!-- Top bar with logo -->
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand pl-4" href="#">
        <svg height="35" viewBox="0 0 347 125" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24.8171" height="24.8171" transform="matrix(-0.86601 0.500028 -3.18907e-05 1 64.6367 12.8008)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.86601 -0.500028 3.18907e-05 1 43.1436 25.2109)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866041 0.499972 0.866041 0.499972 43.1436 0.394531)" fill="#fff"></rect><rect width="24.8171" height="24.8171" transform="matrix(3.19859e-05 1 0.86601 0.500028 21.6487 37.6211)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866041 0.499973 0.866041 0.499972 21.6487 62.4336)" fill="#fff"></rect><rect width="24.8171" height="24.8171" transform="matrix(-3.17834e-05 1 0.866009 -0.500028 0.157593 50.0312)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.86601 0.500028 -3.19781e-05 1 64.6389 87.2539)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866009 -0.500028 3.18033e-05 1 43.1458 99.6641)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866041 0.499972 0.866041 0.499973 43.1458 74.8477)" fill="#fff"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.86601 -0.500028 3.18907e-05 -1 64.6334 112.082)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.86601 0.500028 -3.18907e-05 -1 86.1266 99.6719)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.866041 -0.499972 -0.866041 -0.499972 86.1266 124.488)" fill="#fff"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.86601 0.500028 -3.19781e-05 1 129.114 50.0273)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866009 -0.500028 3.18033e-05 1 107.62 62.4375)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(-0.866041 0.499972 0.866041 0.499973 107.62 37.6211)" fill="#fff"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.86601 -0.500028 3.18907e-05 -1 64.635 37.6289)" fill="#aeaeae"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.86601 0.500028 -3.18907e-05 -1 86.1282 25.2188)" fill="#d6d6d6"></rect><rect width="24.8171" height="24.8171" transform="matrix(0.866041 -0.499972 -0.866041 -0.499972 86.1282 50.0352)" fill="#fff"></rect><path d="M189.374 82.9414 174.851 65.159V82.9414h-8.005V43.031h8.005V60.9278L189.374 43.031H199.037L182.57 62.8147l16.925 20.1267H189.374zm13.328-15.9527C202.702 63.7867 203.331 60.9468 204.589 58.4691 205.885 55.9914 207.619 54.0855 209.792 52.7513 212.003 51.4171 214.461 50.7501 217.168 50.7501 219.531 50.7501 221.59 51.2265 223.343 52.1795 225.135 53.1325 226.564 54.3332 227.631 55.7817v-4.517H235.694V82.9414H227.631V78.31C226.602 79.7966 225.173 81.0355 223.343 82.0266c-1.792.9529-3.869 1.4294-6.232 1.4294C214.442 83.456 212.003 82.7699 209.792 81.3976 207.619 80.0253 205.885 78.1003 204.589 75.6226 203.331 73.1068 202.702 70.2288 202.702 66.9887zm24.929.1143C227.631 65.159 227.25 63.5008 226.488 62.1285 225.725 60.7181 224.696 59.6508 223.4 58.9265 222.104 58.1642 220.713 57.783 219.226 57.783 217.74 57.783 216.367 58.1451 215.109 58.8694 213.851 59.5936 212.822 60.661 212.022 62.0714 211.259 63.4436 210.878 65.0827 210.878 66.9887c0 1.9059.381 3.5831 1.14400000000001 5.0317C212.822 73.4308 213.851 74.5171 215.109 75.2795 216.405 76.0419 217.778 76.4231 219.226 76.4231 220.713 76.4231 222.104 76.061 223.4 75.3367 224.696 74.5743 225.725 73.507 226.488 72.1347 227.25 70.7243 227.631 69.0471 227.631 67.103zm19.94-19.6121C246.161 47.4909 244.979 47.0525 244.026 46.1758 243.112 45.261 242.654 44.1364 242.654 42.8023 242.654 41.4681 243.112 40.3627 244.026 39.4859 244.979 38.5711 246.161 38.1137 247.571 38.1137c1.411.0 2.57300000000001.4574 3.488 1.3722C252.012 40.3627 252.489 41.4681 252.489 42.8023 252.489 44.1364 252.012 45.261 251.059 46.1758 250.144 47.0525 248.982 47.4909 247.571 47.4909zM251.517 51.2647V82.9414h-8.005V51.2647h8.005zm15.914 4.9173C268.46 54.5048 269.794 53.1897 271.433 52.2367 273.11 51.2837 275.016 50.8072 277.151 50.8072v8.4052H275.035C272.519 59.2124 270.614 59.8033 269.317 60.985 268.06 62.1666 267.431 64.2251 267.431 67.1602V82.9414h-8.005V51.2647h8.005V56.182zm29.177 27.274C293.559 83.456 290.814 82.7889 288.375 81.4548 285.935 80.0825 284.01 78.1575 282.6 75.6798 281.228 73.202 280.541 70.3431 280.541 67.103 280.541 63.8629 281.247 61.004 282.657 58.5263 284.106 56.0486 286.069 54.1426 288.546 52.8085 291.024 51.4362 293.788 50.7501 296.837 50.7501 299.887 50.7501 302.65 51.4362 305.128 52.8085 307.606 54.1426 309.55 56.0486 310.96 58.5263 312.409 61.004 313.133 63.8629 313.133 67.103 313.133 70.3431 312.39 73.202 310.903 75.6798 309.455 78.1575 307.472 80.0825 304.957 81.4548 302.479 82.7889 299.696 83.456 296.608 83.456zm0-6.9757C298.057 76.4803 299.41 76.1372 300.668 75.4511 301.964 74.7268 302.993 73.6595 303.756 72.2491 304.518 70.8387 304.899 69.1233 304.899 67.103 304.899 64.0916 304.099 61.7855 302.498 60.1845 300.935 58.5454 299.01 57.7258 296.723 57.7258 294.436 57.7258 292.511 58.5454 290.948 60.1845 289.423 61.7855 288.661 64.0916 288.661 67.103 288.661 70.1144 289.404 72.4397 290.891 74.0788 292.415 75.6798 294.321 76.4803 296.608 76.4803zm34.519 6.9757C328.535 83.456 326.209 82.9986 324.151 82.0837 322.093 81.1308 320.453 79.8538 319.234 78.2528 318.052 76.6518 317.404 74.8793 317.29 72.9352H325.352C325.504 74.155 326.095 75.1652 327.124 75.9657 328.192 76.7662 329.507 77.1664 331.07 77.1664 332.594 77.1664 333.776 76.8615 334.615 76.2516 335.491 75.6417 335.93 74.8602 335.93 73.9072 335.93 72.878 335.396 72.1157 334.329 71.6201 333.299 71.0865 331.641 70.5147 329.354 69.9048 326.991 69.333 325.047 68.7421 323.522 68.1322 322.035 67.5223 320.739 66.5884 319.634 65.3305 318.567 64.0726 318.033 62.3763 318.033 60.2416 318.033 58.4882 318.528 56.8872 319.52 55.4387 320.549 53.9902 321.997 52.8466 323.865 52.008 325.771 51.1694 328.001 50.7501 330.555 50.7501 334.329 50.7501 337.34 51.703 339.589 53.609 341.838 55.4768 343.077 58.0117 343.306 61.2137H335.644C335.529 59.9558 334.996 58.9647 334.043 58.2404 333.128 57.478 331.889 57.0968 330.326 57.0968 328.878 57.0968 327.753 57.3637 326.953 57.8973 326.19 58.431 325.809 59.1743 325.809 60.1273c0 1.0673.533999999999992 1.8869 1.601 2.4587C328.477 63.1196 330.136 63.6723 332.385 64.2441 334.672 64.8159 336.559 65.4067 338.045 66.0166 339.532 66.6266 340.809 67.5795 341.876 68.8756 342.982 70.1335 343.553 71.8107 343.592 73.9072 343.592 75.7369 343.077 77.3761 342.048 78.8246 341.057 80.2731 339.608 81.4167 337.702 82.2553 335.834 83.0558 333.643 83.456 331.127 83.456z" fill="#fff"></path></svg>
        <span class="text-white pl-4 font-bold">Web Installer</span>
      </a>
    </nav>

    <div class="container mt-5">
      <h1>Welcome to the Installer!</h1>
      <p>Enter your <a href="https://kairos.io/docs/reference/configuration/" target="_blank">cloud-config config configuration file</a> and select the device to install on:</p>
      <div class="alert alert-info" role="alert">
        Need help with your cloud config? Check out our <a href="https://kairos.io/docs/examples/" class="alert-link">documentation on where to find examples</a>.
      </div>
      <form action="/install" method="POST">
        <div class="form-group" 
             x-data="{ 
                valid: false,
                show: false,
                error: '',
                content: '#cloud-config',
                getText() {
                  if (this.valid) {
                    return 'Valid YAML syntax'
                  } else {
                    return 'Failed validating syntax: ' + this.error
                  }
                },
                validateYAML() {
                  this.show = true
                  try {
                    // Parse the YAML
                    const yaml = YAML.parse(this.content);
                    this.valid=true
                  } catch(error) {
                    this.error = error
                    this.valid = false
                  }
                }
              }" 
            x-init="
              codeMirrorEditor = CodeMirror.fromTextArea($refs.input, {
                mode: 'yaml',
                theme: 'material',
                lineWrapping: true
              });

              codeMirrorEditor.setValue(content);
              setTimeout(function() {
                codeMirrorEditor.refresh();
              }, 1);

              codeMirrorEditor.on('change', () => content = codeMirrorEditor.getValue())
            " 
            x-on:keydown="validateYAML"
        >
          <label for="cloud-config">Cloud Config</label>
          <div class="alert" x-text="getText" :class="{ 'alert-info': valid, 'alert-danger': !valid }" x-show="show"></div>
          <textarea x-model.debounce.750ms="content" x-ref="input" class="form-control" id="cloud-config" name="cloud-config" rows="5"></textarea>
        </div>
        <div class="form-group">
          <label for="installation-device">Device</label>
          <input type="text" class="form-control" id="installation-device" name="installation-device"  value="auto">
        </div>
        <div class="form-group form-check">
          <input type="checkbox" class="form-check-input" name="reboot">
          <label class="form-check-label" for="reboot">Reboot after installation</label>
        </div>
        <div class="form-group form-check">
          <input type="checkbox" class="form-check-input" name="power-off">
          <label class="form-check-label" for="poweroff">Power off after installation</label>
        </div>
        <button type="submit" class="btn btn-primary">Install</button>
      </form>
    </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="/node_modules/jquery/dist/jquery.slim.min.js" crossorigin="anonymous"></script>
  <script src="/node_modules/@popperjs/core/dist/umd/popper.min.js" crossorigin="anonymous"></script>
  <script src="/node_modules/bootstrap/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
  
  <footer class="bg-light py-3 mt-5 d-flex justify-content-center">
    <div class="container mx-auto">
      <div class="row">
        <div class="col-12 text-center">
          <a href="https://github.com/kairos-io/kairos" target="_blank" class="text-secondary"><i class="fab fa-github fa-2x"></i></a>
          <a href="https://kairos.io/docs" target="_blank" class="text-secondary"><i class="fas fa-book fa-2x"></i></a>
        </div>
      </div>
      <hr>
      <p class="text-center text-secondary py-2">Copyright &copy; Kairos authors 2022-2023</p>
    </div>
  </footer>
  </body>
</html>
